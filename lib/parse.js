"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseMultiple=exports.default=void 0;var _util=require("./util");var _parseVCard=_interopRequireDefault(require("./parsing/parseVCard"));var _parseJCard=_interopRequireDefault(require("./parsing/parseJCard"));var _parseMaggus=_interopRequireDefault(require("./parsing/parseMaggus"));var _unparseVCard=_interopRequireDefault(require("./unparsing/unparseVCard"));var _unparseJCard=_interopRequireDefault(require("./unparsing/unparseJCard"));var _unparseMaggus=_interopRequireDefault(require("./unparsing/unparseMaggus"));var _types=require("./types");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function toMaggus(value){const ding=(0,_util).makeJson(value);if(typeof ding==="object"&&ding!=null){if(Array.isArray(ding)){return(0,_parseJCard).default(ding)}return(0,_parseMaggus).default(ding)}return(0,_parseVCard).default(ding)}function toFormatted(maggus,format,version){if(format==="vcard"){return(0,_unparseVCard).default(maggus,version)}if(format==="jcard"){return(0,_unparseJCard).default(maggus,version)}if(format==="maggus"){return(0,_unparseMaggus).default(maggus,version)}throw new Error(`toFormatted() received invalid format "${format}"`)}const toDataUrl=(value,mimeType)=>`data:${mimeType};charset=UTF-8,${encodeURIComponent(JSON.stringify(value))}`;const getMimeType=format=>{if(format==="vcard")return"text/vcard";if(format==="jcard")return"application/json";if(format==="maggus")return"application/json";throw new Error(`getMimeType() received invalid format "${format}"`)};function parse(value,options={}){const sache=_types.ParseOptionsZod.safeParse(options);if(sache.success===false){const errors=sache.error.issues.map(i=>new _types.VcfOptionsError(i.message+" for "+i.path[0],true));return{errors,data:null,meta:{format:null,version:null,status:"invalid"}}}const{toFormat,toVersion,urlEncode}=sache.data;const maggus=toMaggus(value);const result=toFormatted(maggus.data,toFormat,toVersion);const dater=urlEncode?toDataUrl(result,getMimeType(toFormat)):result;return _extends({},maggus,{data:dater})}var _default=parse;exports.default=_default;function parseMultiple(value,options={}){const vcards=value.match(_util.vcardPattern);return vcards.map(i=>parse(i,options))}exports.parseMultiple=parseMultiple
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9wYXJzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtYWtlSnNvbiwgdmNhcmRQYXR0ZXJuIH0gZnJvbSBcIi4vdXRpbFwiO1xuXG5pbXBvcnQgcGFyc2VWQ2FyZCBmcm9tIFwiLi9wYXJzaW5nL3BhcnNlVkNhcmRcIjtcbmltcG9ydCBwYXJzZUpDYXJkIGZyb20gXCIuL3BhcnNpbmcvcGFyc2VKQ2FyZFwiO1xuaW1wb3J0IHBhcnNlTWFnZ3VzIGZyb20gXCIuL3BhcnNpbmcvcGFyc2VNYWdndXNcIjtcblxuaW1wb3J0IHVucGFyc2VWQ2FyZCBmcm9tIFwiLi91bnBhcnNpbmcvdW5wYXJzZVZDYXJkXCI7XG5pbXBvcnQgdW5wYXJzZUpDYXJkIGZyb20gXCIuL3VucGFyc2luZy91bnBhcnNlSkNhcmRcIjtcbmltcG9ydCB1bnBhcnNlTWFnZ3VzIGZyb20gXCIuL3VucGFyc2luZy91bnBhcnNlTWFnZ3VzXCI7XG5cbmltcG9ydCB7XG4gIFBhcnNlT3B0aW9uc1pvZCxcbiAgUGFyc2VSZXN1bHQsXG4gIFBhcnNlT3B0aW9ucyxcbiAgVmNmRm9ybWF0LFxuICBWY2ZWZXJzaW9uLFxuICBWY2ZGb3JtYXRFcnJvcixcbiAgVmNmT3B0aW9uc0Vycm9yLFxufSBmcm9tIFwiLi90eXBlc1wiO1xuXG4vKipcbiAqIEBwYXJhbSBwYXJhbSBleHBlY3RlZCB0byBtYXRjaCBcIlBST1BFUlRZWz1WQUxVRV1cIiwgd2l0aCA9VkFMVUUgYmVpbmcgb3B0aW9uYWxcbiAqIEBkZXNjIGlmIFZBTFVFIGV4aXN0cywgUFJPUEVSVFk6IFZBTFVFIGFyZSBhZGRlZCBhcyBhIGtleS12YWx1ZS1wYWlyIHRvIHRoZSByZWR1Y2VyLFxuICogZWxzZSBcInR5cGVcIjogUFJPUEVSVFkgaXMgYWRkZWQgYXMgYSBrZXktdmFsdWUtcGFpciB0byB0aGUgcmVkdWNlclxuICpcbiAqIEBleGFtcGxlIHRvUHJvcHMoe30sIFwiVkFMVUU9VVJMXCIpID0+IHsgdmFsdWU6IFwidXJsXCIgfVxuICogQGV4YW1wbGUgdG9Qcm9wcyh7fSwgXCJXT1JLXCIpID0+IHsgdHlwZTogXCJ3b3JrXCIgfVxuICpcbiAqIEBraW5kIHRvIGJlIHVzZWQgYXMgYW4gYXJndW1lbnQgdG8gQXJyYXkucHJvdG90eXBlLnJlZHVjZSgpXG4gKi9cblxuLyoqXG4gKiBAbGluZSBleHBlY3RlZCB0byBtYXRjaCBQUk9QRVJUWVs7S0VZWz1WQUxVRV1dOkF0dHJpYnV0ZVs7QXR0cmlidXRlXVxuICogQGtpbmQgdG8gYmUgdXNlZCBhcyBhbiBhcmd1bWVudCB0byBBcnJheS5wcm90b3R5cGUucmVkdWNlKClcbiAqL1xuXG5mdW5jdGlvbiB0b01hZ2d1cyh2YWx1ZTogc3RyaW5nIHwgQnVmZmVyIHwgYW55W10pIHtcbiAgY29uc3QgZGluZyA9IG1ha2VKc29uKHZhbHVlKTtcblxuICBpZiAodHlwZW9mIGRpbmcgPT09IFwib2JqZWN0XCIgJiYgZGluZyAhPSBudWxsKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZGluZykpIHtcbiAgICAgIHJldHVybiBwYXJzZUpDYXJkKGRpbmcpO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VNYWdndXMoZGluZyk7XG4gIH1cbiAgcmV0dXJuIHBhcnNlVkNhcmQoZGluZyk7XG59XG5mdW5jdGlvbiB0b0Zvcm1hdHRlZChtYWdndXM6IGFueSwgZm9ybWF0OiBWY2ZGb3JtYXQsIHZlcnNpb246IFZjZlZlcnNpb24pIHtcbiAgaWYgKGZvcm1hdCA9PT0gXCJ2Y2FyZFwiKSB7XG4gICAgcmV0dXJuIHVucGFyc2VWQ2FyZChtYWdndXMsIHZlcnNpb24pO1xuICB9XG4gIGlmIChmb3JtYXQgPT09IFwiamNhcmRcIikge1xuICAgIHJldHVybiB1bnBhcnNlSkNhcmQobWFnZ3VzLCB2ZXJzaW9uKTtcbiAgfVxuICBpZiAoZm9ybWF0ID09PSBcIm1hZ2d1c1wiKSB7XG4gICAgcmV0dXJuIHVucGFyc2VNYWdndXMobWFnZ3VzLCB2ZXJzaW9uKTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYHRvRm9ybWF0dGVkKCkgcmVjZWl2ZWQgaW52YWxpZCBmb3JtYXQgXCIke2Zvcm1hdH1cImApO1xufVxuXG5jb25zdCB0b0RhdGFVcmwgPSAodmFsdWU6IGFueSwgbWltZVR5cGU6IHN0cmluZykgPT5cbiAgYGRhdGE6JHttaW1lVHlwZX07Y2hhcnNldD1VVEYtOCwke2VuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeSh2YWx1ZSkpfWA7XG5cbmNvbnN0IGdldE1pbWVUeXBlID0gKGZvcm1hdDogc3RyaW5nKSA9PiB7XG4gIGlmIChmb3JtYXQgPT09IFwidmNhcmRcIikgcmV0dXJuIFwidGV4dC92Y2FyZFwiO1xuICBpZiAoZm9ybWF0ID09PSBcImpjYXJkXCIpIHJldHVybiBcImFwcGxpY2F0aW9uL2pzb25cIjtcbiAgaWYgKGZvcm1hdCA9PT0gXCJtYWdndXNcIikgcmV0dXJuIFwiYXBwbGljYXRpb24vanNvblwiO1xuXG4gIHRocm93IG5ldyBFcnJvcihgZ2V0TWltZVR5cGUoKSByZWNlaXZlZCBpbnZhbGlkIGZvcm1hdCBcIiR7Zm9ybWF0fVwiYCk7XG59O1xuXG5mdW5jdGlvbiBwYXJzZShcbiAgdmFsdWU6IHN0cmluZyB8IEJ1ZmZlciB8IGFueVtdLFxuICBvcHRpb25zOiBQYXJzZU9wdGlvbnMgfCB7fSA9IHt9XG4pOiBQYXJzZVJlc3VsdCB7XG4gIGNvbnN0IHNhY2hlID0gUGFyc2VPcHRpb25zWm9kLnNhZmVQYXJzZShvcHRpb25zKTtcblxuICBpZiAoc2FjaGUuc3VjY2VzcyA9PT0gZmFsc2UpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBzYWNoZS5lcnJvci5pc3N1ZXMubWFwKFxuICAgICAgKGkpID0+IG5ldyBWY2ZPcHRpb25zRXJyb3IoaS5tZXNzYWdlICsgXCIgZm9yIFwiICsgaS5wYXRoWzBdLCB0cnVlKVxuICAgICk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycm9ycyxcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBtZXRhOiB7XG4gICAgICAgIGZvcm1hdDogbnVsbCxcbiAgICAgICAgdmVyc2lvbjogbnVsbCxcbiAgICAgICAgc3RhdHVzOiBcImludmFsaWRcIixcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuICBjb25zdCB7IHRvRm9ybWF0LCB0b1ZlcnNpb24sIHVybEVuY29kZSB9ID0gc2FjaGUuZGF0YSBhcyBQYXJzZU9wdGlvbnM7XG5cbiAgY29uc3QgbWFnZ3VzID0gdG9NYWdndXModmFsdWUpO1xuXG4gIGNvbnN0IHJlc3VsdCA9IHRvRm9ybWF0dGVkKG1hZ2d1cy5kYXRhLCB0b0Zvcm1hdCwgdG9WZXJzaW9uKTtcblxuICBjb25zdCBkYXRlciA9IHVybEVuY29kZSA/IHRvRGF0YVVybChyZXN1bHQsIGdldE1pbWVUeXBlKHRvRm9ybWF0KSkgOiByZXN1bHQ7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5tYWdndXMsXG4gICAgZGF0YTogZGF0ZXIsXG4gIH07XG59XG5leHBvcnQgZGVmYXVsdCBwYXJzZTtcbmV4cG9ydCB7IHBhcnNlTXVsdGlwbGUgfTtcblxuZnVuY3Rpb24gcGFyc2VNdWx0aXBsZShcbiAgdmFsdWU6IHN0cmluZyxcbiAgb3B0aW9uczogUGFyc2VPcHRpb25zIHwge30gPSB7fVxuKTogUGFyc2VSZXN1bHRbXSB7XG4gIGNvbnN0IHZjYXJkcyA9IHZhbHVlLm1hdGNoKHZjYXJkUGF0dGVybik7XG5cbiAgcmV0dXJuIHZjYXJkcy5tYXAoKGk6IHN0cmluZykgPT4gcGFyc2UoaSwgb3B0aW9ucykpO1xufVxuIl0sIm5hbWVzIjpbInRvTWFnZ3VzIiwidmFsdWUiLCJkaW5nIiwibWFrZUpzb24iLCJBcnJheSIsImlzQXJyYXkiLCJwYXJzZUpDYXJkIiwicGFyc2VNYWdndXMiLCJwYXJzZVZDYXJkIiwidG9Gb3JtYXR0ZWQiLCJtYWdndXMiLCJmb3JtYXQiLCJ2ZXJzaW9uIiwidW5wYXJzZVZDYXJkIiwidW5wYXJzZUpDYXJkIiwidW5wYXJzZU1hZ2d1cyIsIkVycm9yIiwidG9EYXRhVXJsIiwibWltZVR5cGUiLCJlbmNvZGVVUklDb21wb25lbnQiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0TWltZVR5cGUiLCJwYXJzZSIsIm9wdGlvbnMiLCJzYWNoZSIsIlBhcnNlT3B0aW9uc1pvZCIsInNhZmVQYXJzZSIsInN1Y2Nlc3MiLCJlcnJvcnMiLCJlcnJvciIsImlzc3VlcyIsIm1hcCIsImkiLCJWY2ZPcHRpb25zRXJyb3IiLCJtZXNzYWdlIiwicGF0aCIsImRhdGEiLCJtZXRhIiwic3RhdHVzIiwidG9Gb3JtYXQiLCJ0b1ZlcnNpb24iLCJ1cmxFbmNvZGUiLCJyZXN1bHQiLCJkYXRlciIsInBhcnNlTXVsdGlwbGUiLCJ2Y2FyZHMiLCJtYXRjaCIsInZjYXJkUGF0dGVybiJdLCJtYXBwaW5ncyI6IkFBQUEsa0hBQXVDLEtBQUEsS0FBUSxTQUFSLFFBQVEsQ0FBQSxBQUV4QixLQUFBLFdBQXNCLGdDQUF0QixzQkFBc0IsRUFBQSxBQUN0QixLQUFBLFdBQXNCLGdDQUF0QixzQkFBc0IsRUFBQSxBQUNyQixLQUFBLFlBQXVCLGdDQUF2Qix1QkFBdUIsRUFBQSxBQUV0QixLQUFBLGFBQTBCLGdDQUExQiwwQkFBMEIsRUFBQSxBQUMxQixLQUFBLGFBQTBCLGdDQUExQiwwQkFBMEIsRUFBQSxBQUN6QixLQUFBLGNBQTJCLGdDQUEzQiwyQkFBMkIsRUFBQSxBQVU5QyxLQUFBLE1BQVMsU0FBVCxTQUFTLENBQUEsdVdBa0JoQixTQUFTQSxRQUFRLENBQUNDLEtBQThCLENBQUUsQ0FDaEQsTUFBTUMsSUFBSSxDQUFHQyxDQUFBQSxFQUFBQSxLQUFRLEFBQU8sQ0FBQSxTQUFQLENBQUNGLEtBQUssQ0FBQyxBQUFDLEFBRTdCLElBQUksT0FBT0MsSUFBSSxHQUFLLFFBQVEsRUFBSUEsSUFBSSxFQUFJLElBQUksQ0FBRSxDQUM1QyxHQUFJRSxLQUFLLENBQUNDLE9BQU8sQ0FBQ0gsSUFBSSxDQUFDLENBQUUsQ0FDdkIsTUFBT0ksQ0FBQUEsRUFBQUEsV0FBVSxBQUFNLENBQUEsUUFBTixDQUFDSixJQUFJLENBQUMsQUFBQyxDQUN6QixBQUNELE1BQU9LLENBQUFB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