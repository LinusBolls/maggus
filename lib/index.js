"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _util=require("./util");var _parseVCard=_interopRequireDefault(require("./parsing/parseVCard"));var _parseJCard=_interopRequireDefault(require("./parsing/parseJCard"));var _parseMaggus=_interopRequireDefault(require("./parsing/parseMaggus"));var _unparseVCard=_interopRequireDefault(require("./unparsing/unparseVCard"));var _unparseJCard=_interopRequireDefault(require("./unparsing/unparseJCard"));var _unparseMaggus=_interopRequireDefault(require("./unparsing/unparseMaggus"));var _types=require("./types");function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function toMaggus(value){const ding=(0,_util).makeJson(value);if(typeof ding==="object"&&ding!=null){if(Array.isArray(ding)){return(0,_parseJCard).default(ding)}return(0,_parseMaggus).default(ding)}return(0,_parseVCard).default(ding)}function toFormatted(maggus,format,version){if(format==="vcard"){return(0,_unparseVCard).default(maggus,version)}if(format==="jcard"){return(0,_unparseJCard).default(maggus,version)}if(format==="maggus"){return(0,_unparseMaggus).default(maggus,version)}throw new Error(`toFormatted() received invalid format "${format}"`)}const toDataUrl=(value,mimeType)=>`data:${mimeType};charset=UTF-8,${encodeURIComponent(JSON.stringify(value))}`;const getMimeType=format=>{if(format==="vcard")return"text/vcard";if(format==="jcard")return"application/json";if(format==="maggus")return"application/json";throw new Error(`getMimeType() received invalid format "${format}"`)};function parse(value,options={}){const sache=_types.ParseOptionsZod.safeParse(options);if(sache.success===false){const errors=sache.error.issues.map(i=>new _types.VcfOptionsError(i.message+" for "+i.path[0],true));return{errors,data:null,meta:{format:null,version:null,status:"invalid"}}}const{toFormat,toVersion,urlEncode}=sache.data;const maggus=toMaggus(value);const result=toFormatted(maggus.data,toFormat,toVersion);const dater=urlEncode?toDataUrl(result,getMimeType(toFormat)):result;return _extends({},maggus,{data:dater})}function parseMultiple(value,options={}){const vcards=value.match(_util.vcardPattern);return vcards.map(i=>parse(i,options))}var _default={parse,parseMultiple};exports.default=_default
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtYWtlSnNvbiwgdmNhcmRQYXR0ZXJuIH0gZnJvbSBcIi4vdXRpbFwiO1xuXG5pbXBvcnQgcGFyc2VWQ2FyZCBmcm9tIFwiLi9wYXJzaW5nL3BhcnNlVkNhcmRcIjtcbmltcG9ydCBwYXJzZUpDYXJkIGZyb20gXCIuL3BhcnNpbmcvcGFyc2VKQ2FyZFwiO1xuaW1wb3J0IHBhcnNlTWFnZ3VzIGZyb20gXCIuL3BhcnNpbmcvcGFyc2VNYWdndXNcIjtcblxuaW1wb3J0IHVucGFyc2VWQ2FyZCBmcm9tIFwiLi91bnBhcnNpbmcvdW5wYXJzZVZDYXJkXCI7XG5pbXBvcnQgdW5wYXJzZUpDYXJkIGZyb20gXCIuL3VucGFyc2luZy91bnBhcnNlSkNhcmRcIjtcbmltcG9ydCB1bnBhcnNlTWFnZ3VzIGZyb20gXCIuL3VucGFyc2luZy91bnBhcnNlTWFnZ3VzXCI7XG5cbmltcG9ydCB7XG4gIFBhcnNlT3B0aW9uc1pvZCxcbiAgUGFyc2VSZXN1bHQsXG4gIFBhcnNlT3B0aW9ucyxcbiAgVmNmRm9ybWF0LFxuICBWY2ZWZXJzaW9uLFxuICBWY2ZGb3JtYXRFcnJvcixcbiAgVmNmT3B0aW9uc0Vycm9yLFxufSBmcm9tIFwiLi90eXBlc1wiO1xuXG4vKipcbiAqIEBwYXJhbSBwYXJhbSBleHBlY3RlZCB0byBtYXRjaCBcIlBST1BFUlRZWz1WQUxVRV1cIiwgd2l0aCA9VkFMVUUgYmVpbmcgb3B0aW9uYWxcbiAqIEBkZXNjIGlmIFZBTFVFIGV4aXN0cywgUFJPUEVSVFk6IFZBTFVFIGFyZSBhZGRlZCBhcyBhIGtleS12YWx1ZS1wYWlyIHRvIHRoZSByZWR1Y2VyLFxuICogZWxzZSBcInR5cGVcIjogUFJPUEVSVFkgaXMgYWRkZWQgYXMgYSBrZXktdmFsdWUtcGFpciB0byB0aGUgcmVkdWNlclxuICpcbiAqIEBleGFtcGxlIHRvUHJvcHMoe30sIFwiVkFMVUU9VVJMXCIpID0+IHsgdmFsdWU6IFwidXJsXCIgfVxuICogQGV4YW1wbGUgdG9Qcm9wcyh7fSwgXCJXT1JLXCIpID0+IHsgdHlwZTogXCJ3b3JrXCIgfVxuICpcbiAqIEBraW5kIHRvIGJlIHVzZWQgYXMgYW4gYXJndW1lbnQgdG8gQXJyYXkucHJvdG90eXBlLnJlZHVjZSgpXG4gKi9cblxuLyoqXG4gKiBAbGluZSBleHBlY3RlZCB0byBtYXRjaCBQUk9QRVJUWVs7S0VZWz1WQUxVRV1dOkF0dHJpYnV0ZVs7QXR0cmlidXRlXVxuICogQGtpbmQgdG8gYmUgdXNlZCBhcyBhbiBhcmd1bWVudCB0byBBcnJheS5wcm90b3R5cGUucmVkdWNlKClcbiAqL1xuXG5mdW5jdGlvbiB0b01hZ2d1cyh2YWx1ZTogc3RyaW5nIHwgQnVmZmVyIHwgYW55W10pIHtcbiAgY29uc3QgZGluZyA9IG1ha2VKc29uKHZhbHVlKTtcblxuICBpZiAodHlwZW9mIGRpbmcgPT09IFwib2JqZWN0XCIgJiYgZGluZyAhPSBudWxsKSB7XG4gICAgaWYgKEFycmF5LmlzQXJyYXkoZGluZykpIHtcbiAgICAgIHJldHVybiBwYXJzZUpDYXJkKGRpbmcpO1xuICAgIH1cbiAgICByZXR1cm4gcGFyc2VNYWdndXMoZGluZyk7XG4gIH1cbiAgcmV0dXJuIHBhcnNlVkNhcmQoZGluZyk7XG59XG5mdW5jdGlvbiB0b0Zvcm1hdHRlZChtYWdndXM6IGFueSwgZm9ybWF0OiBWY2ZGb3JtYXQsIHZlcnNpb246IFZjZlZlcnNpb24pIHtcbiAgaWYgKGZvcm1hdCA9PT0gXCJ2Y2FyZFwiKSB7XG4gICAgcmV0dXJuIHVucGFyc2VWQ2FyZChtYWdndXMsIHZlcnNpb24pO1xuICB9XG4gIGlmIChmb3JtYXQgPT09IFwiamNhcmRcIikge1xuICAgIHJldHVybiB1bnBhcnNlSkNhcmQobWFnZ3VzLCB2ZXJzaW9uKTtcbiAgfVxuICBpZiAoZm9ybWF0ID09PSBcIm1hZ2d1c1wiKSB7XG4gICAgcmV0dXJuIHVucGFyc2VNYWdndXMobWFnZ3VzLCB2ZXJzaW9uKTtcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYHRvRm9ybWF0dGVkKCkgcmVjZWl2ZWQgaW52YWxpZCBmb3JtYXQgXCIke2Zvcm1hdH1cImApO1xufVxuXG5jb25zdCB0b0RhdGFVcmwgPSAodmFsdWU6IGFueSwgbWltZVR5cGU6IHN0cmluZykgPT5cbiAgYGRhdGE6JHttaW1lVHlwZX07Y2hhcnNldD1VVEYtOCwke2VuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeSh2YWx1ZSkpfWA7XG5cbmNvbnN0IGdldE1pbWVUeXBlID0gKGZvcm1hdDogc3RyaW5nKSA9PiB7XG4gIGlmIChmb3JtYXQgPT09IFwidmNhcmRcIikgcmV0dXJuIFwidGV4dC92Y2FyZFwiO1xuICBpZiAoZm9ybWF0ID09PSBcImpjYXJkXCIpIHJldHVybiBcImFwcGxpY2F0aW9uL2pzb25cIjtcbiAgaWYgKGZvcm1hdCA9PT0gXCJtYWdndXNcIikgcmV0dXJuIFwiYXBwbGljYXRpb24vanNvblwiO1xuXG4gIHRocm93IG5ldyBFcnJvcihgZ2V0TWltZVR5cGUoKSByZWNlaXZlZCBpbnZhbGlkIGZvcm1hdCBcIiR7Zm9ybWF0fVwiYCk7XG59O1xuXG5mdW5jdGlvbiBwYXJzZShcbiAgdmFsdWU6IHN0cmluZyB8IEJ1ZmZlciB8IGFueVtdLFxuICBvcHRpb25zOiBQYXJzZU9wdGlvbnMgfCB7fSA9IHt9XG4pOiBQYXJzZVJlc3VsdCB7XG4gIGNvbnN0IHNhY2hlID0gUGFyc2VPcHRpb25zWm9kLnNhZmVQYXJzZShvcHRpb25zKTtcblxuICBpZiAoc2FjaGUuc3VjY2VzcyA9PT0gZmFsc2UpIHtcbiAgICBjb25zdCBlcnJvcnMgPSBzYWNoZS5lcnJvci5pc3N1ZXMubWFwKFxuICAgICAgKGkpID0+IG5ldyBWY2ZPcHRpb25zRXJyb3IoaS5tZXNzYWdlICsgXCIgZm9yIFwiICsgaS5wYXRoWzBdLCB0cnVlKVxuICAgICk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVycm9ycyxcbiAgICAgIGRhdGE6IG51bGwsXG4gICAgICBtZXRhOiB7XG4gICAgICAgIGZvcm1hdDogbnVsbCxcbiAgICAgICAgdmVyc2lvbjogbnVsbCxcbiAgICAgICAgc3RhdHVzOiBcImludmFsaWRcIixcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuICBjb25zdCB7IHRvRm9ybWF0LCB0b1ZlcnNpb24sIHVybEVuY29kZSB9ID0gc2FjaGUuZGF0YSBhcyBQYXJzZU9wdGlvbnM7XG5cbiAgY29uc3QgbWFnZ3VzID0gdG9NYWdndXModmFsdWUpO1xuXG4gIGNvbnN0IHJlc3VsdCA9IHRvRm9ybWF0dGVkKG1hZ2d1cy5kYXRhLCB0b0Zvcm1hdCwgdG9WZXJzaW9uKTtcblxuICBjb25zdCBkYXRlciA9IHVybEVuY29kZSA/IHRvRGF0YVVybChyZXN1bHQsIGdldE1pbWVUeXBlKHRvRm9ybWF0KSkgOiByZXN1bHQ7XG5cbiAgcmV0dXJuIHtcbiAgICAuLi5tYWdndXMsXG4gICAgZGF0YTogZGF0ZXIsXG4gIH07XG59XG5mdW5jdGlvbiBwYXJzZU11bHRpcGxlKFxuICB2YWx1ZTogc3RyaW5nLFxuICBvcHRpb25zOiBQYXJzZU9wdGlvbnMgfCB7fSA9IHt9XG4pOiBQYXJzZVJlc3VsdFtdIHtcbiAgY29uc3QgdmNhcmRzID0gdmFsdWUubWF0Y2godmNhcmRQYXR0ZXJuKTtcblxuICByZXR1cm4gdmNhcmRzLm1hcCgoaTogc3RyaW5nKSA9PiBwYXJzZShpLCBvcHRpb25zKSk7XG59XG5leHBvcnQgZGVmYXVsdCB7IHBhcnNlLCBwYXJzZU11bHRpcGxlIH07XG4iXSwibmFtZXMiOlsidG9NYWdndXMiLCJ2YWx1ZSIsImRpbmciLCJtYWtlSnNvbiIsIkFycmF5IiwiaXNBcnJheSIsInBhcnNlSkNhcmQiLCJwYXJzZU1hZ2d1cyIsInBhcnNlVkNhcmQiLCJ0b0Zvcm1hdHRlZCIsIm1hZ2d1cyIsImZvcm1hdCIsInZlcnNpb24iLCJ1bnBhcnNlVkNhcmQiLCJ1bnBhcnNlSkNhcmQiLCJ1bnBhcnNlTWFnZ3VzIiwiRXJyb3IiLCJ0b0RhdGFVcmwiLCJtaW1lVHlwZSIsImVuY29kZVVSSUNvbXBvbmVudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRNaW1lVHlwZSIsInBhcnNlIiwib3B0aW9ucyIsInNhY2hlIiwiUGFyc2VPcHRpb25zWm9kIiwic2FmZVBhcnNlIiwic3VjY2VzcyIsImVycm9ycyIsImVycm9yIiwiaXNzdWVzIiwibWFwIiwiaSIsIlZjZk9wdGlvbnNFcnJvciIsIm1lc3NhZ2UiLCJwYXRoIiwiZGF0YSIsIm1ldGEiLCJzdGF0dXMiLCJ0b0Zvcm1hdCIsInRvVmVyc2lvbiIsInVybEVuY29kZSIsInJlc3VsdCIsImRhdGVyIiwicGFyc2VNdWx0aXBsZSIsInZjYXJkcyIsIm1hdGNoIiwidmNhcmRQYXR0ZXJuIl0sIm1hcHBpbmdzIjoiQUFBQSw0RkFBdUMsS0FBQSxLQUFRLFNBQVIsUUFBUSxDQUFBLEFBRXhCLEtBQUEsV0FBc0IsZ0NBQXRCLHNCQUFzQixFQUFBLEFBQ3RCLEtBQUEsV0FBc0IsZ0NBQXRCLHNCQUFzQixFQUFBLEFBQ3JCLEtBQUEsWUFBdUIsZ0NBQXZCLHVCQUF1QixFQUFBLEFBRXRCLEtBQUEsYUFBMEIsZ0NBQTFCLDBCQUEwQixFQUFBLEFBQzFCLEtBQUEsYUFBMEIsZ0NBQTFCLDBCQUEwQixFQUFBLEFBQ3pCLEtBQUEsY0FBMkIsZ0NBQTNCLDJCQUEyQixFQUFBLEFBVTlDLEtBQUEsTUFBUyxTQUFULFNBQVMsQ0FBQSx1V0FrQmhCLFNBQVNBLFFBQVEsQ0FBQ0MsS0FBOEIsQ0FBRSxDQUNoRCxNQUFNQyxJQUFJLENBQUdDLENBQUFBLEVBQUFBLEtBQVEsQUFBTyxDQUFBLFNBQVAsQ0FBQ0YsS0FBSyxDQUFDLEFBQUMsQUFFN0IsSUFBSSxPQUFPQyxJQUFJLEdBQUssUUFBUSxFQUFJQSxJQUFJLEVBQUksSUFBSSxDQUFFLENBQzVDLEdBQUlFLEtBQUssQ0FBQ0MsT0FBTyxDQUFDSCxJQUFJLENBQUMsQ0FBRSxDQUN2QixNQUFPSSxDQUFBQSxFQUFBQSxXQUFVLEFBQU0sQ0FBQSxRQUFOLENBQUNKLElBQUksQ0FBQyxBQUFDLENBQ3pCLEFBQ0QsTUFBT0ssQ0FBQUEsRUFBQUEsWUFB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